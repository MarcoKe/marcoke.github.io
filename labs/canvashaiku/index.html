<!DOCTYPE html>
<html>
<body>

<center>
    <h2>Canvas Haiku?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>
    <div id="container">
        <canvas id="myCanvas" height="450" width="450"></canvas>
    </div>
</center>

<script>

// var c = document.getElementById("myCanvas");
// var ctx = c.getContext("2d");
// ctx.beginPath();
// ctx.moveTo(0, 0);
// ctx.lineTo(300, 150);
// ctx.stroke();


var mainCanvas = document.getElementById("myCanvas");
var mainContext = mainCanvas.getContext('2d');

var canvasWidth = mainCanvas.width;
var canvasHeight = mainCanvas.height;

var angle = 0;

var requestAnimationFrame = window.requestAnimationFrame ||
                            window.mozRequestAnimationFrame ||
                            window.webkitRequestAnimationFrame ||
                            window.msRequestAnimationFrame;


function degToRad(deg) {
    return deg * Math.PI/180;
}

function drawTree() {

}

function step(branchesX, branchesY, length, angleLeft, angleRight) {
    var branchesXnew = [];
    var branchesYnew = [];
    for (var j = 0; j < branchesX.length; j++) {
        var endpoints = computeEndPoints(branchesX[j], branchesY[j], length, angleLeft);
        branchesXnew.push(endpoints.x);
        branchesYnew.push(endpoints.y);

        drawBranch(branchesX[j], branchesY[j], endpoints.x, endpoints.y);

        endpoints = computeEndPoints(branchesX[j], branchesY[j], length, angleRight);
        branchesXnew.push(endpoints.x);
        branchesYnew.push(endpoints.y);

        drawBranch(branchesX[j], branchesY[j], endpoints.x, endpoints.y);
    }
    // return {branchesX: branchesXnew, branchesY: branchesYnew, length:    length /= 2};

    setTimeout(function() {
        if (length > 1) {
            requestAnimationFrame(step(branchesXnew, branchesYnew, length/2, angleLeft, angleRight));
        }
        else {
            second = true;
        }
    }, 1000/5);

}

function computeEndPoints(startX, startY, length, degrees) {
    var x = startX + length * Math.cos(degToRad(degrees));
    var y = startY + length * Math.sin(degToRad(degrees));

    return {x,y};
}

function drawBranch(startX, startY, endX, endY) {
    console.log("drawing: " + startX + " " + startY + " " + endX +" " + endY);

    mainContext.beginPath();
    mainContext.moveTo(startX, startY);
    mainContext.lineTo(endX, endY);
    mainContext.stroke();
}
// function drawCircle(startx, starty, length) {
//     if (length > 10)  {
//         var newX = startx + length * Math.cos(degToRad(315));
//         var newY = starty + length * Math.sin(degToRad(315));
//         mainContext.beginPath();
//         mainContext.moveTo(startx, starty);
//         mainContext.lineTo(newX, newY);
//         mainContext.stroke();
//
//
//         var newX2 = startx + length * Math.cos(degToRad(225));
//         var newY2 = starty + length * Math.sin(degToRad(225));
//         mainContext.beginPath();
//         mainContext.moveTo(startx, starty);
//         mainContext.lineTo(newX2, newY2);
//         mainContext.stroke();
//         requestAnimationFrame(drawCircle(newX, newY, length/2));
//         requestAnimationFrame(drawCircle(newX2, newY2, length/2));
//     }
//     // mainContext.clearRect(0, 0, canvasWidth, canvasHeight);
//     //
//     // // color in the background
//     // mainContext.fillStyle = "#EEEEEE";
//     // mainContext.fillRect(0, 0, canvasWidth, canvasHeight);
//     //
//     // // draw the circle
//     // mainContext.beginPath();
//     //
//     // var radius = 25 + 150 * Math.abs(Math.cos(angle));
//     // mainContext.arc(225, 225, radius, 0, Math.PI * 2, false);
//     // mainContext.closePath();
//     //
//     // // color in the circle
//     // mainContext.fillStyle = "#006699";
//     // mainContext.fill();
//     //
//     // angle += Math.PI / 64;
//
//
//     // requestAnimationFrame(drawCircle(startx+50, starty+10));
// }
// drawTree();
var branchesX=[200];
var branchesY=[200];
length = 140;
step(branchesX, branchesY, length, 315, 225);
step(branchesX, branchesY, length, 45, 135);
step(branchesX, branchesY, length, 315, 45);
step(branchesX, branchesY, length, 135, 225);





// for (var iter = 0; iter < 10; iter++) {
//     newParams = requestAnimationFrame(this.step(branchesX, branchesY, length).bind(this));
//     branchesX = newParams.branchesX;
//     branchesY = newParams.branchesY;
//     length = newParams.length;
// }
</script>


</body>
</html>
