<!DOCTYPE HTML>
<html>
<head>
<style>
body {
    background-color: #000000;
    margin: 0px;
    padding: 0px;
}
</style>
</head>
<body>
    <canvas id="myCanvas" width=800 height=800></canvas>
    <script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');

    // network architecture
    var numLayers = 3;
    var numNodes = [9,4,8];

    // why do you not have proper classes javascript?
    var ann = {};
    var inputLayer = {};
    var hiddenLayer = {};
    var outputLayer = {};
    var layers = [inputLayer, hiddenLayer, outputLayer];
    for (var i = 0; i < layers.length; i++) {
        layers[i].nodes = [];
        for (var j = 0; j < numNodes[i]; j++) {
            layers[i].nodes.push({x: 0, y:0});
        }
    }
    ann.layers = layers;

    console.log(ann.layers[0].nodes.length);

    ann.initializePositions = function(startx, starty) {
        for (var i = 0; i < this.layers.length; i++) {
            for (var j = 0; j < this.layers[i].nodes.length; j++) {
                n = this.layers[i].nodes[j];
                n.x = startx * 2*(i+1);
                n.y = (i == 1 ? starty*2 : 0) + starty * (j+1);

            }
        }
    };

    ann.getNodes = function() {
        var nodes = [];
        for (var i = 0; i < this.layers.length; i++) {
            for (var j = 0; j < this.layers[i].nodes.length; j++) {
                nodes.push(this.layers[i].nodes[j]);

            }
        }
        return nodes;
    }

    w1 = [[-0.41, -0.09, -0.09], [3.08, 5.15, -6.15], [1.77, -2.86, 1.15],
        [-2.40, 4.43, 1.18], [-2.32, -5.20, 1.73], [-1.43, -1.82, -1.82],
        [4.85, 3.08, -0.04], [-0.51, -4.14, 2.34], [-2.15, 1.38, 4.49]];


    w2 = [[-0.06, 0.18, 0.00, -0.06, 0.23, 0.15, -0.06, 0.07],
        [0.40, -3.77, -1.23, 0.22, -4.68, 1.17, 4.67, -2.40],
        [2.36, -3.29, 0.20, 1.53, -3.75, -2.03, 1.40, -1.11],
        [-0.17, 2.04, -1.22, 2.91, -2.62, -3.92, 1.68, 0.87]];


    weights = [w1, w2];


    // set node positions
    var startx = 70;
    var starty = 70;
    var radius = 20;

    // var ann = new Net(layers, nodes);
    // ann.initializePositions(startx, starty);
    // drawNet(ann);
    // var ann = new Net(numLayers, numNodes);
    console.log(ann + "\n");
    console.log("layers: " + ann.layers.length);
    console.log("nodes in layer 1: " + ann.layers[0].nodes.length);
    ann.initializePositions(startx, starty);
    drawNet(ann);

    function drawNode(x,y,radius) {
        context.beginPath();
        context.arc(x,y, radius, 0, 2 * Math.PI, false);
        context.fillStyle = 'white';
        context.fill();
        context.lineWidth = 3;
        context.strokeStyle = '#003300';
        context.stroke();
    }

    function drawNet(net) {
        drawLinks(net);

        var nodes = net.getNodes();
        for (var i = 0; i < nodes.length; i++) {
            n = nodes[i];
            drawNode(n.x, n.y, radius);
        }



    }

    function drawLinks(net) {
        context.lineWidth = 3;
        var arr1 = w1.reduce(function (p, c) {
          return p.concat(c);
        });

        var arr2 = w2.reduce(function (p, c) {
          return p.concat(c);
        });

        var arr = arr1.concat(arr2);

        var maxWeights1 = Math.max.apply(null, arr1); // 9
        var minWeights1 = Math.min.apply(null, arr1); // 1
        var maxWeights2 = Math.max.apply(null, arr2); // 9
        var minWeights2 = Math.min.apply(null, arr2); // 1


        for (var i = 0; i < net.layers[0].nodes.length; i++) {
            for (var j = 1; j < net.layers[1].nodes.length; j++) {
                transpPos = (w1[i][j] - Math.max(0,minWeights1)) / (maxWeights1 - Math.max(0,minWeights1));
                transpNeg = (w1[i][j] - minWeights1) / (Math.min(0,maxWeights1) - minWeights1);


                context.beginPath();
                  context.moveTo(net.layers[0].nodes[i].x, net.layers[0].nodes[i].y);
                  context.lineTo(net.layers[1].nodes[j].x, net.layers[1].nodes[j].y);
                  context.strokeStyle = w1[i][j] > 0 ? "rgba(0, 255, 0," + transpPos + ")" : "rgba(255, 0, 0," + transpNeg + ")";
                  context.stroke();
            }
        }

        for (var i = 0; i < net.layers[1].nodes.length; i++) {
            for (var j = 0; j < net.layers[2].nodes.length; j++) {
                transpPos = (w2[i][j] - Math.max(0,minWeights1)) / (maxWeights1 - Math.max(0,minWeights1));
                transpNeg = (w2[i][j] - minWeights1) / (Math.min(0,maxWeights1) - minWeights1);
                context.beginPath();
                  context.moveTo(net.layers[1].nodes[i].x, net.layers[1].nodes[i].y);
                  context.lineTo(net.layers[2].nodes[j].x, net.layers[2].nodes[j].y);
                  context.strokeStyle = w2[i][j] > 0 ? "rgba(0, 255, 0," + transpPos + ")" : "rgba(255, 0, 0," + transpNeg + ")";
                  context.stroke();
            }
        }
    }



    </script>
</body>
</html>
